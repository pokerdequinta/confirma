<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirma√ß√£o de Presen√ßa - 1¬™ Etapa</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Roboto:wght@300;400;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Roboto', sans-serif;background:#0d1b0d;color:#fff;min-height:100vh}
.logo-top{text-align:center;padding:20px}
.logo-top img{max-width:200px}
.container{max-width:1000px;margin:auto;padding:20px}
header{text-align:center;background:#102810;border:2px solid #d4a121;border-radius:15px;padding:30px;margin-bottom:30px}
h1{font-family:'Anton';color:#d4a121;letter-spacing:3px}
.subtitle{margin-top:10px}

/* Estilo do Cron√¥metro */
#countdownContainer {
    background: #1a3d1a;
    border: 2px dashed #d4a121;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    text-align: center;
}
#timer {
    font-family: 'Anton';
    font-size: 1.5em;
    color: #d4a121;
    display: block;
    margin-top: 5px;
}

.info-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:25px}
.info-card{background:#102810;border:2px solid #d4a121;border-radius:12px;padding:20px;text-align:center}
.info-card h2{font-family:'Anton';font-size:2.5em;color:#d4a121}
.add-btn{width:100%;padding:15px;background:#d4a121;border:none;border-radius:10px;font-weight:bold;cursor:pointer;margin-bottom:10px;color:#000;font-family: 'Roboto', sans-serif;}
.cancel-btn-main{width:100%;padding:15px;background:#c72c48;border:none;border-radius:10px;font-weight:bold;cursor:pointer;margin-bottom:20px;color:#fff;font-family: 'Roboto', sans-serif;}
.add-btn:disabled{background:#444; color:#888; cursor:not-allowed; border: 1px solid #555}

.export-btn{background:#2d5016;color:#fff}
.section{background:#102810;border:2px solid #d4a121;border-radius:12px;padding:20px;margin-bottom:25px}
.player-list{list-style:none}
.player-item{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.05);padding:15px;border-radius:10px;margin-bottom:10px;gap:10px}
.player-info{display:flex;gap:15px;align-items:center}
.player-number{font-family:'Anton';color:#d4a121}
.player-details{display:flex;flex-direction:column}
.player-details small{opacity:.85}
.player-badge{background:#d4a121;color:#000;padding:4px 10px;border-radius:20px;font-size:.8em;font-weight:bold}
.wait{background:#c72c48;color:#fff}
.guest{background:#4CAF50;color:#000}
.member{background:#1E90FF;color:#fff}
.remove-btn{background:#c72c48;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
.empty-state{text-align:center;opacity:.7;padding:30px}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);justify-content:center;align-items:center;z-index:1000}
.modal.active{display:flex}
.modal-content{background:#102810;border:2px solid #d4a121;border-radius:15px;padding:30px;width:90%;max-width:500px}
.form-group{margin-bottom:15px}
.form-group label{color:#d4a121;font-weight:bold;display:block;margin-bottom:5px}
.form-group input,.form-group select{width:100%;padding:10px;border-radius:8px;border:1px solid #2d5016;background:#1a3d1a;color:#fff; font-family: 'Roboto';}
.modal-buttons{display:flex;gap:10px;margin-top:20px}
.modal-btn{flex:1;padding:10px;font-weight:bold;border:none;border-radius:8px;cursor:pointer; font-family: 'Roboto';}
.modal-btn.confirm{background:#d4a121;color:#000}
.modal-btn.cancel{background:#c72c48;color:#fff}
.status-indicator{position:fixed;top:10px;right:10px;background:#2d5016;padding:8px 15px;border-radius:20px;font-size:0.85em;border:1px solid #d4a121}
@media(max-width:768px){.info-cards{grid-template-columns:1fr}}
</style>
</head>

<body>

<div class="status-indicator" id="statusIndicator">üîÑ Conectando...</div>

<div class="logo-top">
<img src="logo pdq.png" onerror="this.style.display='none'">
</div>

<div class="container">

<header>
<h1>LISTA DE PRESEN√áA POKER DE QUINTA</h1>
<div class="subtitle">üìÖ 1¬™ Etapa - 29/01/2026</div>
</header>

<div id="countdownContainer">
    <span id="timerLabel">‚è≥ AS INSCRI√á√ïES ABREM EM:</span>
    <div id="timer">Calculando tempo...</div>
</div>

<div class="info-cards">
<div class="info-card"><h2 id="confirmedCount">0</h2>Confirmados</div>
<div class="info-card"><h2 id="vacancyCount">20</h2>Vagas</div>
<div class="info-card"><h2 id="waitlistCount">0</h2>Espera</div>
</div>

<button class="add-btn" id="btnConfirmar" disabled>‚ûï CONFIRMAR PRESEN√áA</button>
<button class="cancel-btn-main" id="btnCancelarWhatsApp">‚ùå CANCELAR MINHA INSCRI√á√ÉO</button>
<button class="add-btn export-btn" id="btnExportar">üìä EXPORTAR CSV</button>

<div class="section">
<h3>‚úÖ CONFIRMADOS</h3>
<ul id="confirmedList" class="player-list"><li class="loading">Carregando...</li></ul>
</div>

<div class="section">
<h3>‚è≥ LISTA DE ESPERA</h3>
<ul id="waitlistList" class="player-list"><li class="loading">Carregando...</li></ul>
</div>
</div>

<div class="modal" id="modalAdmin">
    <div class="modal-content">
        <h2 style="color: #8b0000;">üîê Modo Administrador</h2>
        <div class="form-group"><label>Senha Admin</label><input type="password" id="senhaAdmin"></div>
        <div class="modal-buttons">
            <button class="modal-btn cancel" id="btnFecharAdmin">Cancelar</button>
            <button class="modal-btn confirm" id="btnAcessarAdmin" style="background:#8b0000; color:#fff">Acessar</button>
        </div>
    </div>
</div>

<div class="modal" id="modal">
    <div class="modal-content">
        <h2>Confirmar Presen√ßa</h2>
        <div class="form-group"><label>Jogador</label><select id="playerName"></select></div>
        <div class="form-group"><input type="checkbox" id="isGuest"> Adicionar convidado</div>
        <div class="form-group" id="guestNameGroup" style="display:none"><label>Nome do Convidado</label><input id="guestName"></div>
        <div class="modal-buttons">
            <button class="modal-btn cancel" id="btnCancelar">Cancelar</button>
            <button class="modal-btn confirm" id="btnConfirmarModal">Confirmar</button>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, onValue, remove, push } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
¬† apiKey: "AIzaSyD_XXjcjJYM73wLTTzpDgzKCOZnztcJhjE",
¬† authDomain: "poker-de-quinta.firebaseapp.com",
¬† databaseURL: "https://poker-de-quinta-default-rtdb.firebaseio.com",
¬† projectId: "poker-de-quinta",
¬† storageBucket: "poker-de-quinta.firebasestorage.app",
¬† messagingSenderId: "776724152456",
¬† appId: "1:776724152456:web:fbffde9a1c1a7628c61f3d"
};

const LIMITE_VAGAS = 20;
const DATA_ABERTURA = new Date('2026-01-26T07:00:00').getTime();
const jogadores = ["Amarildo","Boy","Buiu","Caio","Charles","Cleversson","Davi","Gera","Diego","Dos Anjos","Eduardo","Fernando","Gregory","Gaspar","Guilherme","Guti","Igor","Izidio","Jean","Jean Rebuy","Junior","Leo","Loreto","Lucas","Matheus","Maykon","Neto","Nil","Peterson","Rafael","Ricardo Amarante","Ricardo Linhares","Ricardo Matoso","Robson","Sergio","Solano","Tigre","Van Van","Waltinho","Wesley"];

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let confirmados = [];
let listaEspera = [];
let modoAdmin = false;

// L√≥gica do Cron√¥metro
function atualizarCronometro() {
    const agora = new Date().getTime();
    const distancia = DATA_ABERTURA - agora;

    if (distancia > 0) {
        const dias = Math.floor(distancia / (1000 * 60 * 60 * 24));
        const horas = Math.floor((distancia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutos = Math.floor((distancia % (1000 * 60 * 60)) / (1000 * 60));
        const segundos = Math.floor((distancia % (1000 * 60)) / 1000);

        document.getElementById("timer").innerHTML = `${dias}d ${horas}h ${minutos}m ${segundos}s`;
        document.getElementById("btnConfirmar").disabled = true;
        document.getElementById("btnConfirmar").textContent = "üîí LISTA FECHADA";
    } else {
        document.getElementById("countdownContainer").style.display = "none";
        document.getElementById("btnConfirmar").disabled = false;
        document.getElementById("btnConfirmar").textContent = "‚ûï CONFIRMAR PRESEN√áA";
        clearInterval(intervaloTimer);
    }
}
const intervaloTimer = setInterval(atualizarCronometro, 1000);
atualizarCronometro();

// Preencher select
const selectJogador = document.getElementById('playerName');
jogadores.sort().forEach(j => {
    const opt = document.createElement('option');
    opt.value = opt.textContent = j;
    selectJogador.appendChild(opt);
});

// Sync Firebase
onValue(ref(db, 'confirmados'), (snapshot) => {
    confirmados = [];
    if (snapshot.exists()) snapshot.forEach(child => { confirmados.push(child.val()); });
    atualizar();
});

onValue(ref(db, 'listaEspera'), (snapshot) => {
    listaEspera = [];
    if (snapshot.exists()) snapshot.forEach(child => { listaEspera.push(child.val()); });
    atualizar();
});

// Fun√ß√µes de Modal e A√ß√µes
btnConfirmar.onclick = () => {
    if (new Date().getTime() < DATA_ABERTURA && !modoAdmin) {
        alert("A lista ainda n√£o est√° aberta!");
        return;
    }
    document.getElementById('modal').classList.add('active');
};

btnCancelar.onclick = () => document.getElementById('modal').classList.remove('active');
isGuest.onchange = e => document.getElementById('guestNameGroup').style.display = e.target.checked ? 'block' : 'none';

btnConfirmarModal.onclick = async () => {
    const nome = selectJogador.value;
    if (!nome) return alert('Selecione um nome');
    
    const jaInscrito = [...confirmados, ...listaEspera].some(p => p.nome === nome);
    if (!isGuest.checked && jaInscrito) return alert('Jogador j√° inscrito!');

    const agora = new Date().toISOString();
    try {
        if (!isGuest.checked) {
            const lista = confirmados.length < LIMITE_VAGAS ? 'confirmados' : 'listaEspera';
            const novoRef = push(ref(db, lista));
            await set(novoRef, { id: novoRef.key, nome, isGuest: false, data: agora });
        } else {
            const gNome = document.getElementById('guestName').value;
            if (!gNome) return alert('Nome do convidado?');
            const novoRef = push(ref(db, 'listaEspera'));
            await set(novoRef, { id: novoRef.key, nome: gNome, isGuest: true, guestOf: nome, data: agora });
        }
        document.getElementById('modal').classList.remove('active');
    } catch (e) { alert('Erro ao salvar'); }
};

btnCancelarWhatsApp.onclick = () => {
    const msg = encodeURIComponent('Ol√°! Quero cancelar minha inscri√ß√£o no Poker de Quinta.\nNome: ');
    window.open(`https://wa.me/5541987210685?text=${msg}`, '_blank');
};

function atualizar() {
    document.getElementById('statusIndicator').textContent = '‚úÖ Conectado';
    document.getElementById('confirmedCount').textContent = confirmados.length;
    document.getElementById('vacancyCount').textContent = Math.max(0, LIMITE_VAGAS - confirmados.length);
    document.getElementById('waitlistCount').textContent = listaEspera.length;

    const render = (p, i, wait) => `
        <li class="player-item">
            <div class="player-info">
                <div class="player-number">${i+1}¬∫</div>
                <div class="player-details"><strong>${p.nome}</strong><small>üïí ${new Date(p.data).toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'})}</small></div>
            </div>
            <span class="player-badge ${p.isGuest ? 'guest' : (jogadores.includes(p.nome) && !wait ? 'member' : 'wait')}">
                ${p.isGuest ? 'CONVIDADO' : (wait ? 'ESPERA' : 'MEMBRO')}
            </span>
        </li>`;

    document.getElementById('confirmedList').innerHTML = confirmados.map((p, i) => render(p, i, false)).join('') || '<li class="empty-state">Vazio</li>';
    document.getElementById('waitlistList').innerHTML = listaEspera.map((p, i) => render(p, i, true)).join('') || '<li class="empty-state">Vazio</li>';
}
</script>
</body>
</html>
