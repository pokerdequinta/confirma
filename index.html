<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirma√ß√£o de Presen√ßa - 1¬™ Etapa</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Roboto:wght@300;400;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Roboto', sans-serif;background:#0d1b0d;color:#fff;min-height:100vh}
.logo-top{text-align:center;padding:20px}
.logo-top img{max-width:200px}
.container{max-width:1000px;margin:auto;padding:20px}
header{text-align:center;background:#102810;border:2px solid #d4a121;border-radius:15px;padding:30px;margin-bottom:30px}
h1{font-family:'Anton';color:#d4a121;letter-spacing:3px}
.subtitle{margin-top:10px}

#countdownContainer {
    background: #1a3d1a;
    border: 2px dashed #d4a121;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    text-align: center;
}
.timer-header { font-family: 'Anton'; font-size: 1.2em; color: #fff; margin-bottom: 5px; display: block; }
#timer { font-family: 'Anton'; font-size: 1.8em; color: #d4a121; }

.info-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:25px}
.info-card{background:#102810;border:2px solid #d4a121;border-radius:12px;padding:20px;text-align:center}
.info-card h2{font-family:'Anton';font-size:2.5em;color:#d4a121}
.add-btn{width:100%;padding:15px;background:#d4a121;border:none;border-radius:10px;font-weight:bold;cursor:pointer;margin-bottom:10px;color:#000}
.cancel-btn-main{width:100%;padding:15px;background:#c72c48;border:none;border-radius:10px;font-weight:bold;cursor:pointer;margin-bottom:20px;color:#fff}
.add-btn:disabled{opacity:0.5;cursor:not-allowed}
.export-btn{background:#2d5016;color:#fff}
.section{background:#102810;border:2px solid #d4a121;border-radius:12px;padding:20px;margin-bottom:25px}
.player-list{list-style:none}
.player-item{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.05);padding:15px;border-radius:10px;margin-bottom:10px;gap:10px}
.player-info{display:flex;gap:15px;align-items:center}
.player-number{font-family:'Anton';color:#d4a121}
.player-details{display:flex;flex-direction:column}
.player-details small{opacity:.85}
.player-badge{background:#d4a121;color:#000;padding:4px 10px;border-radius:20px;font-size:.8em;font-weight:bold}
.wait{background:#c72c48;color:#fff}
.guest{background:#4CAF50;color:#000}
.member{background:#1E90FF;color:#fff}
.remove-btn{background:#c72c48;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
.empty-state{text-align:center;opacity:.7;padding:30px}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);justify-content:center;align-items:center;z-index:1000}
.modal.active{display:flex}
.modal-content{background:#102810;border:2px solid #d4a121;border-radius:15px;padding:30px;width:90%;max-width:500px}
.form-group{margin-bottom:15px}
.form-group label{color:#d4a121;font-weight:bold;display:block;margin-bottom:5px}
.form-group input,.form-group select{width:100%;padding:10px;border-radius:8px;border:1px solid #2d5016;background:#1a3d1a;color:#fff}
.modal-buttons{display:flex;gap:10px;margin-top:20px}
.modal-btn{flex:1;padding:10px;font-weight:bold;border:none;border-radius:8px;cursor:pointer}
.modal-btn.confirm{background:#d4a121;color:#000}
.modal-btn.cancel{background:#c72c48;color:#fff}
.loading{text-align:center;padding:20px;opacity:0.7}
.status-indicator{position:fixed;top:10px;right:10px;background:#2d5016;padding:8px 15px;border-radius:20px;font-size:0.85em;border:1px solid #d4a121}
.status-indicator.connected{background:#1a3d1a;border-color:#4CAF50}
.status-indicator.error{background:#3d1a1a;border-color:#c72c48}
.priority-indicator{background:#FFA500;color:#000;padding:2px 8px;border-radius:10px;font-size:0.75em;margin-left:5px}
@media(max-width:768px){
.info-cards{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="status-indicator" id="statusIndicator">üîÑ Conectando...</div>

<div class="logo-top">
<img src="logo pdq.png" onerror="this.style.display='none'">
</div>

<div class="container">

<header>
<h1>LISTA DE PRESEN√áA POKER DE QUINTA</h1>
<div class="subtitle">üìÖ 1¬™ Etapa - 29/01/2026</div>
</header>

<div id="countdownContainer">
    <span class="timer-header">As Inscri√ß√µes abrem dia 26/01 √†s 07:00</span>
    <div id="timer">Calculando tempo...</div>
</div>

<div class="info-cards">
<div class="info-card"><h2 id="confirmedCount">0</h2>Confirmados</div>
<div class="info-card"><h2 id="vacancyCount">20</h2>Vagas</div>
<div class="info-card"><h2 id="waitlistCount">0</h2>Espera</div>
</div>

<button class="add-btn" id="btnConfirmar" disabled>üîí INSCRI√á√ïES FECHADAS</button>
<button class="cancel-btn-main" id="btnCancelarWhatsApp">‚ùå CANCELAR MINHA INSCRI√á√ÉO</button>
<button class="add-btn export-btn" id="btnExportar">üìä EXPORTAR CSV</button>

<div class="section">
<h3>‚úÖ CONFIRMADOS</h3>
<ul id="confirmedList" class="player-list">
<li class="loading">Carregando dados...</li>
</ul>
</div>

<div class="section">
<h3>‚è≥ LISTA DE ESPERA</h3>
<p style="opacity:0.8;margin-bottom:15px;font-size:0.9em">
  üî∏ Membros t√™m prioridade sobre convidados ‚Ä¢ Ordem de chegada dentro de cada categoria
</p>
<ul id="waitlistList" class="player-list">
<li class="loading">Carregando dados...</li>
</ul>
</div>

</div>

<button class="add-btn" id="btnModoAdmin" style="position:fixed;bottom:10px;right:10px;width:auto;padding:8px 15px;background:rgba(13,27,13,0.3);border:1px solid rgba(212,161,33,0.1);opacity:0.15;font-size:0.7em;transition:opacity 0.3s">üîê</button>

<div class="modal" id="modalAdmin">
<div class="modal-content">
<h2 style="color: #8b0000;">üîê Modo Administrador</h2>
<p style="margin: 15px 0; opacity: 0.8;">Digite a senha de administrador para acessar fun√ß√µes exclusivas:</p>
<div class="form-group">
<label>Senha Admin</label>
<input type="password" id="senhaAdmin" placeholder="Digite a senha">
</div>
<div class="modal-buttons">
<button class="modal-btn cancel" id="btnFecharAdmin">Cancelar</button>
<button class="modal-btn confirm" id="btnAcessarAdmin" style="background:#8b0000; color:#fff">Acessar</button>
</div>
</div>
</div>

<div class="modal" id="modalBemVindo">
<div class="modal-content">
<h2 style="color: #d4a121;">üìã Bem-vindo ao Poker de Quinta!</h2>
<p style="margin: 15px 0; line-height: 1.6;">Esta √© a p√°gina oficial de inscri√ß√£o do <strong>Poker de Quinta</strong>.</p>
<p style="margin: 15px 0; line-height: 1.6; font-size:0.9em">
  <strong>Regras importantes:</strong><br>
  ‚Ä¢ Limite de 20 vagas confirmadas<br>
  ‚Ä¢ Confirme a presen√ßa somente se for ir com CERTEZA<br>
  ‚Ä¢ Caso n√£o possa ir a etapa clique no bot√£o CANCELAR MINHA INSCRI√á√ÉO<br>
  ‚Ä¢ Ap√≥s 20 confirma√ß√µes, novos jogadores v√£o para lista de espera<br>
  ‚Ä¢ Na lista de espera: membros t√™m prioridade sobre convidados
</p>
<div class="modal-buttons">
<button class="modal-btn confirm" id="btnEntendi" style="width:100%">Entendi!</button>
</div>
</div>
</div>

<div class="modal" id="modal">
<div class="modal-content">
<h2>Confirmar Presen√ßa</h2>
<div class="form-group">
<label>Jogador</label>
<select id="playerName"></select>
</div>
<div class="form-group">
<input type="checkbox" id="isGuest"> Adicionar convidado
</div>
<div class="form-group" id="guestNameGroup" style="display:none">
<label>Nome do Convidado</label>
<input id="guestName" placeholder="Digite o nome completo">
</div>
<div class="modal-buttons">
<button class="modal-btn cancel" id="btnCancelar">Cancelar</button>
<button class="modal-btn confirm" id="btnConfirmarModal">Confirmar</button>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, onValue, remove, push, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyD_XXjcjJYM73wLTTzpDgzKCOZnztcJhjE",
  authDomain: "poker-de-quinta.firebaseapp.com",
  databaseURL: "https://poker-de-quinta-default-rtdb.firebaseio.com",
  projectId: "poker-de-quinta",
  storageBucket: "poker-de-quinta.firebasestorage.app",
  messagingSenderId: "776724152456",
  appId: "1:776724152456:web:fbffde9a1c1a7628c61f3d"
};

const LIMITE_VAGAS = 20;
const DATA_ABERTURA = new Date('2026-01-26T07:00:00').getTime();
const jogadores = ["Amarildo","Boy","Buiu","Caio","Charles","Cleversson","Davi","Gera","Diego","Dos Anjos","Eduardo","Fernando","Gregory","Gaspar","Guilherme","Guti","Igor","Izidio","Jean","Jean Rebuy","Junior","Leo","Loreto","Lucas","Matheus","Maykon","Neto","Nil","Peterson","Rafael","Ricardo Amarante","Ricardo Linhares","Ricardo Matoso","Robson","Sergio","Solano","Tigre","Van Van","Waltinho","Wesley"];

let db;
let confirmados = [];
let listaEspera = [];
let modoAdmin = false;

function atualizarCronometro() {
    const agora = new Date().getTime();
    const dist = DATA_ABERTURA - agora;

    if (dist > 0) {
        const d = Math.floor(dist / (1000 * 60 * 60 * 24));
        const h = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((dist % (1000 * 60)) / 1000);
        document.getElementById("timer").innerHTML = `${d}d ${h}h ${m}m ${s}s`;
        document.getElementById("btnConfirmar").disabled = true;
    } else {
        document.getElementById("countdownContainer").style.display = "none";
        document.getElementById("btnConfirmar").disabled = false;
        document.getElementById("btnConfirmar").textContent = "‚ûï CONFIRMAR PRESEN√áA";
        clearInterval(timerInterval);
    }
}
const timerInterval = setInterval(atualizarCronometro, 1000);
atualizarCronometro();

try {
  const app = initializeApp(firebaseConfig);
  db = getDatabase(app);
  statusIndicator.textContent = '‚úÖ Conectado';
  statusIndicator.classList.add('connected');
  
  onValue(ref(db, 'confirmados'), (snapshot) => {
    confirmados = [];
    if (snapshot.exists()) snapshot.forEach(child => { confirmados.push({...child.val(), id: child.key}); });
    atualizar();
  });
  
  onValue(ref(db, 'listaEspera'), (snapshot) => {
    listaEspera = [];
    if (snapshot.exists()) snapshot.forEach(child => { listaEspera.push({...child.val(), id: child.key}); });
    atualizar();
  });
} catch (e) {
  statusIndicator.textContent = '‚ùå Erro de conex√£o';
  statusIndicator.classList.add('error');
}

const selectJogador = document.getElementById('playerName');
const optDefault = document.createElement('option');
optDefault.value = '';
optDefault.textContent = 'Selecione seu nome...';
selectJogador.appendChild(optDefault);
jogadores.sort().forEach(j => {
  const o = document.createElement('option');
  o.value = o.textContent = j;
  selectJogador.appendChild(o);
});

btnEntendi.onclick = () => modalBemVindo.classList.remove('active');
window.addEventListener('load', () => modalBemVindo.classList.add('active'));

btnConfirmar.onclick = () => {
    if (new Date().getTime() < DATA_ABERTURA && !modoAdmin) return alert("A lista ainda n√£o abriu!");
    modal.classList.add('active');
};
btnCancelar.onclick = () => {
  modal.classList.remove('active');
  selectJogador.value = '';
  isGuest.checked = false;
  guestNameGroup.style.display = 'none';
  document.getElementById('guestName').value = '';
};
isGuest.onchange = e => guestNameGroup.style.display = e.target.checked ? 'block' : 'none';

btnConfirmarModal.onclick = async () => {
  const nome = selectJogador.value;
  if (!nome) return alert('Selecione seu nome!');
  
  // Verificar se j√° est√° inscrito (membro)
  if (!isGuest.checked) {
    const jaInscrito = [...confirmados, ...listaEspera].some(p => !p.isGuest && p.nome === nome);
    if (jaInscrito) {
      return alert('Voc√™ j√° est√° inscrito!');
    }
  }
  
  const agora = new Date().toISOString();
  
  try {
    if (!isGuest.checked) {
      // MEMBRO - verificar vagas em tempo real
      const snapshot = await get(ref(db, 'confirmados'));
      const totalAtual = snapshot.exists() ? snapshot.size : 0;
      
      if (totalAtual < LIMITE_VAGAS) {
        // Tem vaga - adicionar em confirmados
        await push(ref(db, 'confirmados'), { 
          nome, 
          isGuest: false, 
          data: agora,
          timestamp: Date.now()
        });
        alert('‚úÖ Presen√ßa confirmada! Voc√™ est√° na lista de confirmados.');
      } else {
        // Sem vagas - adicionar na lista de espera
        await push(ref(db, 'listaEspera'), { 
          nome, 
          isGuest: false, 
          data: agora,
          timestamp: Date.now()
        });
        alert('‚è≥ As 20 vagas foram preenchidas!\n\nVoc√™ foi adicionado √† LISTA DE ESPERA.\n\nMembros t√™m prioridade sobre convidados na fila.');
      }
    } else {
      // CONVIDADO - sempre vai para lista de espera
      const gNome = document.getElementById('guestName').value.trim();
      if (!gNome) return alert('Digite o nome do convidado!');
      
      await push(ref(db, 'listaEspera'), { 
        nome: gNome, 
        isGuest: true, 
        guestOf: nome, 
        data: agora,
        timestamp: Date.now()
      });
      alert('‚úÖ Convidado adicionado √† lista de espera!\n\nConvidados ficam ap√≥s membros na ordem de prioridade.');
    }
    
    modal.classList.remove('active');
    selectJogador.value = '';
    isGuest.checked = false;
    guestNameGroup.style.display = 'none';
    document.getElementById('guestName').value = '';
    
  } catch (e) { 
    alert('Erro ao confirmar: ' + e.message); 
  }
};

btnCancelarWhatsApp.onclick = () => {
  const msg = encodeURIComponent('Gostaria de cancelar minha inscri√ß√£o no Poker de Quinta,Eu sei que fui um cagalh√£o,isso nao vai mais acontecer.\nNome: ');
  window.open(`https://wa.me/5541987210685?text=${msg}`, '_blank');
};

function atualizar() {
  confirmedCount.textContent = confirmados.length;
  vacancyCount.textContent = Math.max(0, LIMITE_VAGAS - confirmados.length);
  waitlistCount.textContent = listaEspera.length;

  // LISTA DE CONFIRMADOS - ordenar por timestamp
  const confirmadosOrdenados = [...confirmados].sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
  
  confirmedList.innerHTML = confirmadosOrdenados.length ? '' : '<li class="empty-state">Nenhuma confirma√ß√£o</li>';
  confirmadosOrdenados.forEach((p, i) => {
    const btnRemover = modoAdmin ? `<button class="remove-btn" onclick="removerJogador('${p.id}',false)">‚ùå</button>` : '';
    const badge = p.isGuest ? '<span class="player-badge guest">CONVIDADO</span>' : '<span class="player-badge member">MEMBRO</span>';
    const guestInfo = p.isGuest && p.guestOf ? ` <small style="opacity:0.7">(Convidado de ${p.guestOf})</small>` : '';
    
    confirmedList.innerHTML += `<li class="player-item">
        <div class="player-info"><div class="player-number">${i+1}¬∫</div>
        <div class="player-details"><strong>${p.nome}${guestInfo}</strong><small>üïí ${new Date(p.data).toLocaleString('pt-BR', {day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'})}</small></div></div>
        ${badge}
        ${btnRemover}</li>`;
  });

  // LISTA DE ESPERA - ORDENAR: membros primeiro, depois convidados, por timestamp dentro de cada grupo
  const membrosEspera = listaEspera.filter(p => !p.isGuest).sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
  const convidadosEspera = listaEspera.filter(p => p.isGuest).sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
  const listaEsperaOrdenada = [...membrosEspera, ...convidadosEspera];

  waitlistList.innerHTML = listaEsperaOrdenada.length ? '' : '<li class="empty-state">Fila vazia</li>';
  listaEsperaOrdenada.forEach((p, i) => {
    const btnRemover = modoAdmin ? `<button class="remove-btn" onclick="removerJogador('${p.id}',true)">‚ùå</button>` : '';
    const btnPromover = modoAdmin && confirmados.length < LIMITE_VAGAS ? 
      `<button class="remove-btn" style="background:#4CAF50" onclick="promoverJogadorManual('${p.id}')">‚ÜóÔ∏è PROMOVER</button>` : '';
    const guestInfo = p.isGuest && p.guestOf ? ` (Convidado de ${p.guestOf})` : '';
    const badge = p.isGuest ? '<span class="player-badge guest">CONVIDADO</span>' : '<span class="player-badge wait">MEMBRO</span>';
    const prioridade = !p.isGuest && i < membrosEspera.length ? '<span class="priority-indicator">PRIORIDADE</span>' : '';
    
    waitlistList.innerHTML += `<li class="player-item">
        <div class="player-info"><div class="player-number">${i+1}¬∫</div>
        <div class="player-details"><strong>${p.nome}${guestInfo}</strong><small>üïí ${new Date(p.data).toLocaleString('pt-BR', {day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'})}</small></div></div>
        <div style="display:flex;gap:5px;align-items:center">
          ${badge}
          ${prioridade}
          ${btnPromover}
          ${btnRemover}
        </div>
        </li>`;
  });
}

window.removerJogador = async (id, isWait) => {
  if(!confirm('Tem certeza que deseja remover este jogador?')) return;
  try {
    const path = isWait ? 'listaEspera' : 'confirmados';
    await remove(ref(db, `${path}/${id}`));
    
    // Se removeu dos confirmados, promover da lista de espera
    if (!isWait) {
      await promoverDaListaDeEspera();
    }
    
    alert('Jogador removido com sucesso!');
  } catch (e) {
    alert('Erro ao remover: ' + e.message);
  }
};

// Fun√ß√£o para promover automaticamente da lista de espera
async function promoverDaListaDeEspera() {
  try {
    // Verificar quantos confirmados existem
    const snapshotConfirmados = await get(ref(db, 'confirmados'));
    const totalConfirmados = snapshotConfirmados.exists() ? snapshotConfirmados.size : 0;
    
    // Se tiver vaga dispon√≠vel
    if (totalConfirmados < LIMITE_VAGAS) {
      // Buscar lista de espera atual
      const snapshotEspera = await get(ref(db, 'listaEspera'));
      
      if (snapshotEspera.exists()) {
        let candidatos = [];
        snapshotEspera.forEach(child => {
          candidatos.push({...child.val(), id: child.key});
        });
        
        // APENAS MEMBROS s√£o promovidos automaticamente
        const membros = candidatos.filter(p => !p.isGuest).sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
        
        if (membros.length > 0) {
          // Pegar o primeiro MEMBRO da fila
          const promovido = membros[0];
          
          // Adicionar aos confirmados
          await push(ref(db, 'confirmados'), {
            nome: promovido.nome,
            isGuest: false,
            data: promovido.data,
            timestamp: promovido.timestamp,
            promovido: true,
            dataPromocao: new Date().toISOString()
          });
          
          // Remover da lista de espera
          await remove(ref(db, `listaEspera/${promovido.id}`));
          
          console.log(`‚úÖ ${promovido.nome} (MEMBRO) foi promovido automaticamente para confirmados!`);
        } else {
          console.log('‚ÑπÔ∏è H√° vaga dispon√≠vel, mas apenas convidados na fila. Promo√ß√£o manual necess√°ria.');
        }
      }
    }
  } catch (e) {
    console.error('Erro ao promover da lista de espera:', e);
  }
}

// Fun√ß√£o para promover jogador manualmente (ADMIN)
window.promoverJogadorManual = async (id) => {
  try {
    // Verificar se h√° vaga
    const snapshotConfirmados = await get(ref(db, 'confirmados'));
    const totalConfirmados = snapshotConfirmados.exists() ? snapshotConfirmados.size : 0;
    
    if (totalConfirmados >= LIMITE_VAGAS) {
      return alert('‚ùå N√£o h√° vagas dispon√≠veis!\n\nRemova um jogador dos confirmados primeiro.');
    }
    
    // Buscar dados do jogador na lista de espera
    const snapshot = await get(ref(db, `listaEspera/${id}`));
    
    if (!snapshot.exists()) {
      return alert('Jogador n√£o encontrado!');
    }
    
    const jogador = snapshot.val();
    
    // Confirmar promo√ß√£o
    const tipoJogador = jogador.isGuest ? 'CONVIDADO' : 'MEMBRO';
    if (!confirm(`Promover ${jogador.nome} (${tipoJogador}) para confirmados?`)) {
      return;
    }
    
    // Adicionar aos confirmados
    await push(ref(db, 'confirmados'), {
      nome: jogador.nome,
      isGuest: jogador.isGuest,
      guestOf: jogador.guestOf || null,
      data: jogador.data,
      timestamp: jogador.timestamp,
      promovido: true,
      promocaoManual: true,
      dataPromocao: new Date().toISOString()
    });
    
    // Remover da lista de espera
    await remove(ref(db, `listaEspera/${id}`));
    
    alert(`‚úÖ ${jogador.nome} foi promovido para confirmados!`);
    
  } catch (e) {
    alert('Erro ao promover: ' + e.message);
  }
};

btnModoAdmin.onclick = () => modalAdmin.classList.add('active');
btnFecharAdmin.onclick = () => modalAdmin.classList.remove('active');
btnAcessarAdmin.onclick = () => {
  if (document.getElementById('senhaAdmin').value === "poker2026") {
    modoAdmin = true;
    modalAdmin.classList.remove('active');
    btnModoAdmin.style.background = '#4CAF50';
    btnModoAdmin.style.opacity = '1';
    alert("‚úÖ Modo Administrador Ativado!\n\nVoc√™ agora pode remover jogadores.");
    atualizar();
  } else {
    alert('‚ùå Senha incorreta!');
  }
};

btnExportar.onclick = () => {
  let csv = 'Posi√ß√£o,Nome,Status,Data/Hora\n';
  confirmados.forEach((p, i) => {
    csv += `${i+1},${p.nome},CONFIRMADO,${new Date(p.data).toLocaleString('pt-BR')}\n`;
  });
  
  const listaEsperaOrdenada = [
    ...listaEspera.filter(p => !p.isGuest).sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0)),
    ...listaEspera.filter(p => p.isGuest).sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0))
  ];
  
  listaEsperaOrdenada.forEach((p, i) => {
    const tipo = p.isGuest ? 'CONVIDADO' : 'ESPERA';
    const nome = p.isGuest && p.guestOf ? `${p.nome} (Convidado de ${p.guestOf})` : p.nome;
    csv += `${i+1},${nome},${tipo},${new Date(p.data).toLocaleString('pt-BR')}\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `lista-poker-${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
};
</script>
</body>
</html>



